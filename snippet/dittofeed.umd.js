(function(m,y){typeof exports=="object"&&typeof module<"u"?module.exports=y():typeof define=="function"&&define.amd?define(y):(m=typeof globalThis<"u"?globalThis:m||self,m._df=y())})(this,function(){"use strict";var m=globalThis&&globalThis.__awaiter||function(e,t,n,i){function s(u){return u instanceof n?u:new n(function(o){o(u)})}return new(n||(n=Promise))(function(u,o){function f(a){try{r(i.next(a))}catch(h){o(h)}}function d(a){try{r(i.throw(a))}catch(h){o(h)}}function r(a){a.done?u(a.value):s(a.value).then(f,d)}r((i=i.apply(e,t||[])).next())})};class y{constructor({batchSize:t,timeout:n,executeBatch:i,setTimeout:s,clearTimeout:u}){this.queue=[],this.batchSize=t,this.timeout=n,this.timeoutHandle=null,this.executeBatch=i,this.setTimeout=s,this.clearTimeout=u}submit(t){this.queue.push(t),this.queue.length>=this.batchSize?this.flush():this.queue.length===1&&this.startTimer()}startTimer(){this.timeoutHandle=this.setTimeout(()=>this.flush(),this.timeout)}clearTimer(){this.timeoutHandle&&(this.clearTimeout(this.timeoutHandle),this.timeoutHandle=null)}flush(){return m(this,void 0,void 0,function*(){if(this.clearTimer(),this.queue.length===0)return;const t=this.queue.slice(0,this.batchSize);this.queue=this.queue.slice(this.batchSize),yield this.executeBatch(t)})}}var w=globalThis&&globalThis.__awaiter||function(e,t,n,i){function s(u){return u instanceof n?u:new n(function(o){o(u)})}return new(n||(n=Promise))(function(u,o){function f(a){try{r(i.next(a))}catch(h){o(h)}}function d(a){try{r(i.throw(a))}catch(h){o(h)}}function r(a){a.done?u(a.value):s(a.value).then(f,d)}r((i=i.apply(e,t||[])).next())})},l;(function(e){e.Identify="identify",e.Track="track",e.Page="page",e.Screen="screen"})(l||(l={}));class k{constructor({issueRequest:t,writeKey:n,host:i="https://dittofeed.com",uuid:s,setTimeout:u,clearTimeout:o}){this.batchQueue=new y({timeout:500,batchSize:5,setTimeout:u,clearTimeout:o,executeBatch:f=>w(this,void 0,void 0,function*(){yield t({batch:f},{writeKey:n,host:i})})}),this.uuid=s}identify(t){var n;const i=Object.assign({messageId:(n=t.messageId)!==null&&n!==void 0?n:this.uuid(),type:l.Identify},t);this.batchQueue.submit(i)}track(t){var n;const i=Object.assign({messageId:(n=t.messageId)!==null&&n!==void 0?n:this.uuid(),type:l.Track},t);this.batchQueue.submit(i)}page(t){var n;const i=Object.assign({messageId:(n=t.messageId)!==null&&n!==void 0?n:this.uuid(),type:l.Page},t);this.batchQueue.submit(i)}screen(t){var n;const i=Object.assign({messageId:(n=t.messageId)!==null&&n!==void 0?n:this.uuid(),type:l.Screen},t);this.batchQueue.submit(i)}flush(){return w(this,void 0,void 0,function*(){yield this.batchQueue.flush()})}}let g;const v=new Uint8Array(16);function I(){if(!g&&(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!g))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(v)}const c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function x(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}const T={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function U(e,t,n){if(T.randomUUID&&!t&&!e)return T.randomUUID();e=e||{};const i=e.random||(e.rng||I)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){n=n||0;for(let s=0;s<16;++s)t[n+s]=i[s];return t}return x(i)}const S=class b{static async init(t){if(!b.instance){const n=new k({uuid:()=>U(),issueRequest:async(i,{host:s="https://dittofeed.com",writeKey:u})=>{const o=`${s}/api/public/apps/batch`,d=await fetch(o,{method:"POST",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify(i)});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`)},setTimeout:(i,s)=>window.setTimeout(i,s),clearTimeout:i=>window.clearTimeout(i),...t});b.instance=new b(n)}return b.instance}constructor(t){this.baseSdk=t}static identify(t){if(this.instance)return this.instance.baseSdk.identify(t)}static track(t){if(this.instance)return this.instance.baseSdk.track(t)}static page(t){if(this.instance)return this.instance.baseSdk.page(t)}static screen(t){if(this.instance)return this.instance.baseSdk.screen(t)}static flush(){if(this.instance)return this.instance.baseSdk.flush()}};S.instance=null;let p=S;function _(){const e=document.getElementById("df-tracker");if(!e)return null;const t=e.getAttribute("data-write-key");return t?{writeKey:t,host:e.getAttribute("data-host")??void 0}:null}return async function(){const t=_();if(t){const n=window_.df;await p.init(t),Array.isArray(n)&&n.forEach(i=>{if(Array.isArray(i)&&i.length>0){const s=i[0];p[s].apply(p,i.slice(1))}}),window._df=p}}(),p});
